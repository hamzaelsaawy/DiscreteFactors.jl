#
# Factors Join Tests
#

let
ϕ1 = Factor([:X, :C, :Y, :A, :Z], [3, 2, 3, 2, 3])
ϕ2 = Factor([:A, :B, :C], [2, 3, 2])
ϕ1.potential[:] = collect(1.0:length(ϕ1))
ϕ2.potential[:] = collect(1.0:length(ϕ2))

# why did I do this?
true_pot = [1.0,2.0,3.0,28.0,35.0,42.0,7.0,8.0,9.0,70.0,77.0,84.0,13.0,14.0,
         15.0,112.0,119.0,126.0,38.0,40.0,42.0,176.0,184.0,192.0,50.0,52.0,
         54.0,224.0,232.0,240.0,62.0,64.0,66.0,272.0,280.0,288.0,37.0,38.0,
         39.0,280.0,287.0,294.0,43.0,44.0,45.0,322.0,329.0,336.0,49.0,50.0,
         51.0,364.0,371.0,378.0,110.0,112.0,114.0,464.0,472.0,480.0,122.0,
         124.0,126.0,512.0,520.0,528.0,134.0,136.0,138.0,560.0,568.0,576.0,
         73.0,74.0,75.0,532.0,539.0,546.0,79.0,80.0,81.0,574.0,581.0,588.0,
         85.0,86.0,87.0,616.0,623.0,630.0,182.0,184.0,186.0,752.0,760.0,768.0,
         194.0,196.0,198.0,800.0,808.0,816.0,206.0,208.0,210.0,848.0,856.0,
         864.0,3.0,6.0,9.0,36.0,45.0,54.0,21.0,24.0,27.0,90.0,99.0,108.0,39.0,
         42.0,45.0,144.0,153.0,162.0,76.0,80.0,84.0,220.0,230.0,240.0,100.0,
         104.0,108.0,280.0,290.0,300.0,124.0,128.0,132.0,340.0,350.0,360.0,
         111.0,114.0,117.0,360.0,369.0,378.0,129.0,132.0,135.0,414.0,423.0,
         432.0,147.0,150.0,153.0,468.0,477.0,486.0,220.0,224.0,228.0,580.0,
         590.0,600.0,244.0,248.0,252.0,640.0,650.0,660.0,268.0,272.0,276.0,
         700.0,710.0,720.0,219.0,222.0,225.0,684.0,693.0,702.0,237.0,240.0,
         243.0,738.0,747.0,756.0,255.0,258.0,261.0,792.0,801.0,810.0,364.0,
         368.0,372.0,940.0,950.0,960.0,388.0,392.0,396.0,1000.0,1010.0,1020.0,
         412.0,416.0,420.0,1060.0,1070.0,1080.0,5.0,10.0,15.0,44.0,55.0,66.0,
         35.0,40.0,45.0,110.0,121.0,132.0,65.0,70.0,75.0,176.0,187.0,198.0,
         114.0,120.0,126.0,264.0,276.0,288.0,150.0,156.0,162.0,336.0,348.0,
         360.0,186.0,192.0,198.0,408.0,420.0,432.0,185.0,190.0,195.0,440.0,
         451.0,462.0,215.0,220.0,225.0,506.0,517.0,528.0,245.0,250.0,255.0,
         572.0,583.0,594.0,330.0,336.0,342.0,696.0,708.0,720.0,366.0,372.0,
         378.0,768.0,780.0,792.0,402.0,408.0,414.0,840.0,852.0,864.0,365.0,
         370.0,375.0,836.0,847.0,858.0,395.0,400.0,405.0,902.0,913.0,924.0,
         425.0,430.0,435.0,968.0,979.0,990.0,546.0,552.0,558.0,1128.0,1140.0,
         1152.0,582.0,588.0,594.0,1200.0,1212.0,1224.0,618.0,624.0,630.0,
         1272.0,1284.0,1296.0]

ϕ12 = ϕ1 * ϕ2
@test ϕ12.potential[:] == true_pot
end

let
# dimensions don't have the same lengths
ϕ1 = Factor([:X, :Y, :Z], [3, 3, 3])
ϕ2 = Factor([:A, :X, :Y], [2, 31, 3])

@test_throws DimensionMismatch ϕ1 * ϕ2
end
